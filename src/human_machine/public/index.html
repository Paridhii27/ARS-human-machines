<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Conversations with machines</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    <div class="main-container">
      <h1>Conversations with machines</h1>
      <div class="functionality-container">
        <div class="user-inputs">
          <div class="prompt-input-field">
            <input
              id="prompt"
              type="text"
              placeholder="prompt"
              class="block rounded w-full py-2 px-4 text-black"
            />
          </div>
          <div class="machine_generators">
            <button id="dalle">Machine 1</button>
            <button id="fal">Machine 2</button>
            <button id="falfast">Machine 3</button>
          </div>

          <button id="makeprompt">Make Prompt</button>
        </div>
        <div class="machine-outputs">
          <div id="output" class="p-4"></div>
          <div id="prompt-history" class="p-4"></div>
          <div id="resultText"></div>
        </div>
      </div>
    </div>

    <script>
      const promptElement = document.getElementById("prompt");
      const dalleButton = document.getElementById("dalle");
      dalleButton.addEventListener("click", () => {
        const prompt = promptElement.value || "no prompt";
        fetch(`/api/dalle?prompt=${prompt}`)
          .then((response) => response.text())
          .then((url) => {
            const e = document.createElement("div");
            const machinePrompt = document.createElement("div");
            const promptText = document.createElement("div"); // Create a new div for prompt text

            e.innerHTML = `
            <div class="mb-4">
              <img class="block" src="${url}" style="width: 20vw; height: auto; display: block; margin: auto;"/>
            </div>
            `;
            machinePrompt.innerHTML = ` 
            <div class="mb-4">
              <div class="p-4 bg-gray-500 text-white w-1/2">${prompt}</div>
            </div>
            `;
            promptText.innerHTML = `${prompt}`; // Set the prompt text in the new div

            const output = document.getElementById("output");
            const promptList = document.getElementById("prompt-history");

            output.insertBefore(e, output.firstChild);
            promptList.insertBefore(promptText, promptList.firstChild); // Append the prompt text to the prompt history div
            // promptList.insertBefore(machinePrompt, promptList.firstChild);
          })
          .catch((error) => {
            console.error("Error:", error);
          });
        fetch(`/api/gpt??prompt=${promptElement.value}`)
          .then((response) => response.text())
          .then((responseText) => {
            const responseElement = document.createElement("p");
            responseElement.innerText = responseText;
            document.body.appendChild(responseElement);
          });
      });

      const falButton = document.getElementById("fal");
      falButton.addEventListener("click", () => {
        fetch(`/api/fal?prompt=${promptElement.value}`)
          .then((response) => response.text())
          .then((url) => {
            const e = document.createElement("div");
            const machinePrompt = document.createElement("div");

            e.innerHTML = `
            <div class="mb-4">
              <img class="block" src="${url}" style="width: 20vw; height: auto; display: block; margin: auto;/>
            </div>
            `;
            machinePrompt.innerHTML = ` <div class="mb-4">
              <div class="p-4 bg-gray-500 text-white w-1/2">${prompt}</div>
              </div>
              `;
            const output = document.getElementById("output");
            const promptList = document.getElementById("prompt-history");

            output.insertBefore(e, output.firstChild);
            promptList.insertBefore(machinePrompt, promptList.firstChild);
          });
        fetch(`/api/gpt??prompt=${promptElement.value}`)
          .then((response) => response.text())
          .then((responseText) => {
            const responseElement = document.createElement("p");
            responseElement.innerText = responseText;

            const existingDiv = document.getElementById("resultText");

            // Append the responseElement as a child of the existing div
            resultText.appendChild(responseElement);
          });
      });

      const falfastButton = document.getElementById("falfast");
      falfastButton.addEventListener("click", () => {
        fetch(`/api/falfast?prompt=${promptElement.value}`)
          .then((response) => response.text())
          .then((url) => {
            const e = document.createElement("div");

            e.innerHTML = `
            <div class="mb-4">
              <img class="block" src="${url}" />
              <div class="p-4 bg-gray-500 text-white w-1/2">${
                promptElement.value || "no prompt"
              }</div>
            </div>
            `;
            const output = document.getElementById("output");

            output.insertBefore(e, output.firstChild);
          });
        fetch(`/api/gpt??prompt=${promptElement.value}`)
          .then((response) => response.text())
          .then((responseText) => {
            const responseElement = document.createElement("p");
            responseElement.innerText = responseText;
            document.body.appendChild(responseElement);
          });
      });

      const makepromptButton = document.getElementById("makeprompt");
      makepromptButton.addEventListener("click", () => {
        const style = [
          "three dimensional render",
          "illustration",
          "cyberpunk render",
          "minimalist render",
        ];
        const machines = [
          "Computer",
          "washing machine",
          "digital camera",
          "watch",
          "radio",
          "blender",
          "microwave",
          "tape recorder",
          "television",
          "tape recorder",
          "phone",
        ];

        const features = [
          "gestural control",
          "multimodal interaction",
          "accessibility",
          "sustainability",
          "adaptability",
          "voice control",
          "ethical design",
          "plasticity",
          "haptic feedback",
          "augmented reality",
          "emotional intelligence",
          "context awareness",
        ];

        promptElement.value = `Create a three dimensional render of a ${pick(
          machines
        )} based on the key feature of ${pick(
          features
        )}. Make sure the image background is black.`;
      });

      function pick(arr) {
        return arr[Math.floor(Math.random() * arr.length)];
      }
    </script>
  </body>
</html>
